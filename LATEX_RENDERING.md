# LaTeX Mathematical Notation Support

## Overview

The CBT exam system now supports professional mathematical notation using LaTeX rendering with KaTeX. Questions generated by the AI will automatically render mathematical expressions beautifully.

## What's Been Added

### Dependencies

- ✅ `katex@^0.16.11` - Industry-standard LaTeX math rendering engine
- ✅ KaTeX CSS imported globally for proper math styling

### Enhanced Components

- ✅ **QuestionCard.tsx** - Now parses and renders LaTeX mathematical expressions

## How It Works

### Inline Math (Small Equations)

Use single dollar signs `$...$` for inline mathematical expressions:

**Example:**

```
The quadratic formula is $x^2 + 5x + 6 = 0$
```

**Renders as:**
The quadratic formula is x² + 5x + 6 = 0 (with proper superscripts)

### Display Math (Block Equations)

Use double dollar signs `$$...$$` for centered, larger mathematical expressions:

**Example:**

```
Evaluate the integral:
$$\int_0^\pi \sin(x) \, dx$$
```

**Renders as:**
A centered, large equation with proper integral symbol and limits

## Supported Mathematical Notation

### Basic Operations

- **Superscripts**: `$x^2$` → x²
- **Subscripts**: `$x_1$` → x₁
- **Fractions**: `$\frac{a}{b}$` → a/b (with proper fraction bar)
- **Square roots**: `$\sqrt{x}$` → √x
- **nth roots**: `$\sqrt[n]{x}$` → ⁿ√x

### Greek Letters

- **Lowercase**: `$\alpha$`, `$\beta$`, `$\gamma$`, `$\theta$`, `$\pi$`
- **Uppercase**: `$\Gamma$`, `$\Delta$`, `$\Sigma$`, `$\Omega$`

### Calculus

- **Integrals**: `$\int_a^b f(x) \, dx$`
- **Derivatives**: `$\frac{dy}{dx}$`, `$f'(x)$`
- **Partial derivatives**: `$\frac{\partial f}{\partial x}$`
- **Limits**: `$\lim_{x \to \infty} f(x)$`

### Summations and Products

- **Sum**: `$\sum_{i=1}^{n} i$`
- **Product**: `$\prod_{i=1}^{n} i$`

### Matrices

```
$$\begin{pmatrix}
a & b \\
c & d
\end{pmatrix}$$
```

### Trigonometry

- `$\sin(x)$`, `$\cos(x)$`, `$\tan(x)$`
- `$\arcsin(x)$`, `$\arccos(x)$`, `$\arctan(x)$`

### Logic and Set Theory

- **Set notation**: `$\{1, 2, 3\}$`
- **Element of**: `$x \in A$`
- **Subset**: `$A \subseteq B$`
- **Union/Intersection**: `$A \cup B$`, `$A \cap B$`

### Special Symbols

- **Infinity**: `$\infty$`
- **Plus/minus**: `$\pm$`
- **Not equal**: `$\neq$`
- **Less/greater or equal**: `$\leq$`, `$\geq$`
- **Approximately**: `$\approx$`

## Usage Examples

### Algebra Questions

```
Q1. Solve the equation: $x^2 - 5x + 6 = 0$

Q2. Simplify: $\frac{x^2 - 4}{x - 2}$

Q3. Find the value of $x$ when $2^x = 32$
```

### Calculus Questions

```
Q1. Evaluate: $$\int_0^1 x^2 \, dx$$

Q2. Find the derivative: $\frac{d}{dx}(x^3 + 2x^2 - 5x + 1)$

Q3. Calculate the limit: $$\lim_{x \to 0} \frac{\sin(x)}{x}$$
```

### Geometry/Trigonometry Questions

```
Q1. In a right triangle, if $\sin(\theta) = \frac{3}{5}$, find $\cos(\theta)$

Q2. The area of a circle is $A = \pi r^2$ where $r = 5$ cm

Q3. Prove: $\sin^2(x) + \cos^2(x) = 1$
```

### Physics/Chemistry Questions

```
Q1. Einstein's equation: $E = mc^2$

Q2. The ideal gas law: $PV = nRT$

Q3. Quadratic formula: $$x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$$
```

## Backend Integration

When the AI backend generates questions, it should format mathematical expressions with LaTeX syntax:

**API Response Example:**

```json
{
  "questions": [
    {
      "title": "Solve the quadratic equation",
      "body": "Find the roots of $x^2 + 5x + 6 = 0$ using the quadratic formula $$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$$",
      "type": "descriptive"
    }
  ]
}
```

The frontend QuestionCard component will automatically parse and render the LaTeX expressions.

## Error Handling

If invalid LaTeX syntax is encountered, the component gracefully falls back to displaying the raw expression in a red code block:

**Example:**

```
$\invalid\syntax$
```

**Renders as:** A red-highlighted inline code block showing the invalid LaTeX

This prevents crashes and alerts that there's a formatting issue.

## Testing LaTeX Rendering

### Test Case 1: Basic Math

Create a question with: `$x^2 + 2x + 1 = 0$`

- ✅ Should show x² + 2x + 1 = 0 with proper superscripts

### Test Case 2: Fractions

Create a question with: `$\frac{1}{2}$`

- ✅ Should show 1/2 with proper fraction bar

### Test Case 3: Display Math

Create a question with: `$$\int_0^\infty e^{-x} dx = 1$$`

- ✅ Should show centered, large equation with integral symbol

### Test Case 4: Greek Letters

Create a question with: `$\alpha + \beta = \gamma$`

- ✅ Should show α + β = γ

### Test Case 5: Complex Equation

Create a question with: `$$\sum_{i=1}^{n} i = \frac{n(n+1)}{2}$$`

- ✅ Should show summation notation with limits and fraction

## Browser Compatibility

KaTeX renders consistently across all modern browsers:

- ✅ Chrome/Edge (Chromium)
- ✅ Firefox
- ✅ Safari
- ✅ Mobile browsers

## Performance

- **Rendering**: Fast client-side rendering (no server requests)
- **Caching**: useMemo hooks prevent unnecessary re-renders
- **Bundle size**: KaTeX is ~350KB (minified + gzipped)
- **No impact**: Questions without math render as before

## Future Enhancements

Potential improvements (not yet implemented):

- [ ] Chemistry equation support with mhchem
- [ ] Interactive math expressions
- [ ] Copy LaTeX source to clipboard
- [ ] Math expression editor for teachers

## Troubleshooting

### Math not rendering

**Issue**: Seeing raw `$x^2$` instead of x²
**Solution**:

1. Check that `npm install` completed successfully
2. Verify KaTeX CSS is imported in globals.css
3. Clear browser cache and restart dev server

### Red error boxes showing

**Issue**: Math shows in red code blocks
**Cause**: Invalid LaTeX syntax in the question text
**Solution**: Check the LaTeX syntax in the backend AI prompts

### Build errors

**Issue**: TypeScript or build errors
**Solution**:

1. Run `npm install` to ensure dependencies are installed
2. Check that katex types are available
3. Restart TypeScript server in VS Code

## Resources

- **KaTeX Documentation**: https://katex.org/docs/supported.html
- **LaTeX Math Symbols**: https://katex.org/docs/support_table.html
- **KaTeX Functions**: https://katex.org/docs/supported.html

---

**Status**: ✅ Implemented and Ready to Use
**Next Step**: Test with questions containing mathematical expressions
